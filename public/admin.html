<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barista Flow - HayÄ±r Kafe</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #1e1e1e;
            --card-dark: #2d2d2d;
            --starbucks-green: #00704A;
            /* Starbucks YeÅŸili */
            --latte-accent: #d4e9e2;
            --text-white: #ffffff;
            --text-gray: #a0a0a0;
            --danger: #ff5f57;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-white);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header TasarÄ±mÄ± */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 0 10px;
        }

        .header-logo {
            height: 40px;
            width: auto;
            object-fit: contain;
        }

        .brand-title {
            font-size: 2rem;
            font-weight: 900;
            letter-spacing: -1px;
            background: linear-gradient(90deg, #fff, #a0a0a0);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-badge {
            background: rgba(0, 112, 74, 0.2);
            color: var(--starbucks-green);
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid var(--starbucks-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cafe-status-btn {
            background: rgba(0, 112, 74, 0.2);
            color: var(--starbucks-green);
            border: 1px solid var(--starbucks-green);
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .cafe-status-btn:hover {
            background: var(--starbucks-green);
            color: white;
        }

        .cafe-status-btn.cafe-closed {
            background: rgba(255, 95, 87, 0.2);
            color: var(--danger);
            border-color: var(--danger);
        }

        .cafe-status-btn.cafe-closed:hover {
            background: var(--danger);
            color: white;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background-color: var(--starbucks-green);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--starbucks-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        /* Ä°statistikler (Stories TarzÄ±) */
        .top-stats-group {
            display: flex;
            flex-direction: row;
            /* Horizontal */
            gap: 12px;
            margin-left: auto;
            padding-left: 20px;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Adjust stats within top bar */
        .top-stats-group .stat-pill {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 4px 12px;
            flex-direction: row;
            /* Horizontal content inside pill */
            align-items: center;
            gap: 8px;
            min-width: auto;
            /* Remove min-width for compactness */
        }

        .top-stats-group .stat-label {
            font-size: 0.75rem;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 4px;
            /* Space between label and value */
        }

        .top-stats-group .stat-value {
            font-size: 1rem;
            font-weight: 700;
        }

        .stats-container {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .stat-pill {
            background: var(--card-dark);
            min-width: 120px;
            padding: 15px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-gray);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Grid YapÄ±sÄ± */
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        /* Modern Kart TasarÄ±mÄ± */
        .order-card {
            background: var(--card-dark);
            border-radius: 24px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: slideIn 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .order-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--starbucks-green);
        }

        .card-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .guest-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-white);
        }

        .time-badge {
            background: #1a1a1a;
            color: var(--text-gray);
            font-size: 0.8rem;
            padding: 6px 12px;
            border-radius: 12px;
            font-family: monospace;
        }

        .phone-badge {
            background: #2a2a2a;
            color: var(--primary-color);
            font-size: 0.8rem;
            padding: 6px 12px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .order-item {
            font-size: 1.6rem;
            font-weight: 900;
            /* Extra Bold */
            color: var(--latte-accent);
            line-height: 1.2;
            margin-bottom: 25px;
        }

        /* Dev Buton */
        .btn-complete {
            background: var(--starbucks-green);
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        /* Dev Buton */
        .btn-complete {
            background: var(--starbucks-green);
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .btn-complete:active {
            transform: scale(0.95);
            background: #005c3c;
        }

        .btn-stock {
            background: rgba(255, 95, 87, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-stock:hover {
            background: var(--danger);
            color: white;
        }

        .btn-stock.in-stock {
            background: rgba(0, 112, 74, 0.2);
            color: var(--starbucks-green);
            border-color: var(--starbucks-green);
        }

        .btn-stock.in-stock:hover {
            background: var(--starbucks-green);
            color: white;
        }

        .stock-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
            color: var(--text-gray);
            background: var(--card-dark);
            border-radius: 24px;
            border: 2px dashed rgba(255, 255, 255, 0.05);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.2;
        }

        /* Stok YÃ¶netimi Sekmeleri */
        .tabs-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 15px;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: var(--text-gray);
            padding: 10px 20px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            position: relative;
            bottom: -15px;
        }

        .tab-btn:hover {
            color: var(--text-white);
        }

        .tab-btn.active {
            color: var(--starbucks-green);
            border-bottom-color: var(--starbucks-green);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Raporlar Stilleri */
        .reports-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .report-filter-btn {
            background: var(--card-dark);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-filter-btn:hover {
            border-color: var(--starbucks-green);
            color: var(--text-white);
        }

        .report-filter-btn.active {
            background: var(--starbucks-green);
            border-color: var(--starbucks-green);
            color: white;
        }

        .report-section h3 {
            color: var(--text-white);
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .report-card {
            background: var(--card-dark);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .report-card h4 {
            color: var(--starbucks-green);
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .report-item:last-child {
            border-bottom: none;
        }

        .report-name {
            color: var(--text-white);
            font-weight: 500;
        }

        .report-count {
            color: var(--latte-accent);
            font-weight: 700;
            background: rgba(212, 233, 226, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
        }

        /* Stok Grid */
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .stock-item {
            background: var(--card-dark);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .stock-item:hover {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .stock-item-name {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-white);
        }

        .stock-toggle-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .stock-toggle-btn.available {
            background: rgba(0, 112, 74, 0.3);
            color: var(--starbucks-green);
            border: 1px solid var(--starbucks-green);
        }

        .stock-toggle-btn.available:hover {
            background: var(--starbucks-green);
            color: white;
        }

        .stock-toggle-btn.unavailable {
            background: rgba(255, 95, 87, 0.3);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .stock-toggle-btn.unavailable:hover {
            background: var(--danger);
            color: white;
        }

        /* Cafe durum kontrol kartÄ± */
        .cafe-control-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 14px 16px;
            margin: 12px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow-soft);
        }

        .cafe-control-card h4 {
            grid-column: 1 / -1;
            margin: 0;
            font-size: 1rem;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cafe-control-card .muted {
            grid-column: 1 / -1;
            color: var(--text-dimmed);
            font-size: 0.9rem;
            margin-top: -4px;
        }

        .cafe-control-card label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-dimmed);
            font-size: 0.9rem;
        }

        .cafe-control-card input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
            background: var(--card-bg-dark);
            color: var(--text-white);
            font-size: 0.95rem;
        }

        .cafe-control-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .cafe-control-btn {
            flex: 1;
            min-width: 160px;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
            background: var(--accent-3);
            color: var(--text-white);
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .cafe-control-btn.secondary {
            background: var(--card-bg-dark);
        }

        .cafe-control-btn.danger {
            background: rgba(255, 95, 87, 0.15);
            border-color: var(--danger);
            color: var(--danger);
        }

        .cafe-control-btn:hover {
            filter: brightness(1.05);
        }

        .input-with-quick-select {
            position: relative;
        }

        .quick-select-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .quick-select-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--card-border);
            background: rgba(0, 112, 74, 0.1);
            color: var(--starbucks-green);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-select-btn:hover {
            background: var(--starbucks-green);
            color: white;
        }

        /* Top Control Bar */
        .top-control-bar {
            background: linear-gradient(135deg, var(--card-dark) 0%, rgba(0, 30, 20, 0.95) 100%);
            border: 1px solid rgba(0, 112, 74, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .status-indicators {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.95rem;
            background: rgba(255, 95, 87, 0.2);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        .status-badge.open {
            background: rgba(0, 112, 74, 0.2);
            border-color: var(--starbucks-green);
            color: var(--starbucks-green);
        }

        .status-badge.live-badge {
            background: rgba(0, 112, 74, 0.2);
            border-color: var(--starbucks-green);
            color: var(--starbucks-green);
            animation: livePulse 2s infinite;
        }

        @keyframes livePulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-10px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(10px);
            }
        }

        .control-buttons-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .ctrl-btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: var(--card-dark);
            color: var(--text-white);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .ctrl-btn:hover {
            border-color: var(--starbucks-green);
            background: rgba(0, 112, 74, 0.2);
            transform: translateY(-1px);
        }

        .ctrl-btn.active {
            background: var(--starbucks-green);
            border-color: var(--starbucks-green);
            color: white;
            box-shadow: 0 0 15px rgba(0, 112, 74, 0.4);
        }

        .ctrl-btn.open-btn {
            background: var(--starbucks-green);
            border-color: var(--starbucks-green);
            color: white;
        }

        .ctrl-btn.open-btn:hover {
            background: #005c3c;
            box-shadow: 0 0 15px rgba(0, 112, 74, 0.5);
        }

        /* Quick Actions Grid - Keep for compatibility but hide */
        .quick-actions-grid {
            display: none;
        }

        .quick-btn {
            padding: 14px 18px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: var(--card-dark);
            color: var(--text-white);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .quick-btn:hover {
            border-color: var(--starbucks-green);
            background: rgba(0, 112, 74, 0.1);
        }

        .quick-btn.active {
            background: var(--starbucks-green);
            border-color: var(--starbucks-green);
            color: white;
            box-shadow: 0 0 15px rgba(0, 112, 74, 0.3);
        }

        .quick-btn.close-btn:hover {
            background: rgba(255, 95, 87, 0.2);
            border-color: var(--danger);
            color: var(--danger);
        }

        .quick-btn.open-btn {
            grid-column: span 2;
            background: var(--starbucks-green);
            border-color: var(--starbucks-green);
            color: white;
        }

        .quick-btn.open-btn:hover {
            background: #005c3c;
            box-shadow: 0 0 20px rgba(0, 112, 74, 0.4);
        }

        /* Notification Permission Banner */
        .notification-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--starbucks-green) 0%, #005c3c 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .notification-banner-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .notification-banner-icon {
            font-size: 1.5rem;
            animation: ring 2s infinite;
        }

        @keyframes ring {

            0%,
            100% {
                transform: rotate(0deg);
            }

            10%,
            30% {
                transform: rotate(-10deg);
            }

            20%,
            40% {
                transform: rotate(10deg);
            }
        }

        .notification-banner-text {
            flex: 1;
        }

        .notification-banner-text strong {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .notification-banner-text small {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .enable-sound-btn {
            background: white;
            color: var(--starbucks-green);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .enable-sound-btn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .enable-sound-btn:active {
            transform: scale(0.95);
        }

        /* Audio Status Indicator */
        .audio-status-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card-dark);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .audio-status-badge.enabled {
            border-color: var(--starbucks-green);
            background: rgba(0, 112, 74, 0.1);
        }

        .audio-status-badge.disabled {
            border-color: var(--danger);
            background: rgba(255, 95, 87, 0.1);
        }

        .audio-status-badge i {
            font-size: 1.2rem;
        }

        .audio-status-badge.enabled i {
            color: var(--starbucks-green);
        }

        .audio-status-badge.disabled i {
            color: var(--danger);
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, var(--starbucks-green) 0%, #005c3c 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 112, 74, 0.4);
            z-index: 9998;
            animation: slideInRight 0.3s ease-out, pulse 0.5s ease-in-out 3;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-notification.fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(400px);
            }
        }

        .toast-notification-icon {
            font-size: 1.8rem;
            animation: bounce 0.5s ease-in-out 3;
        }


        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-10px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(10px);
            }
        }

        .toast-notification-content strong {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .toast-notification-content small {
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <audio id="notificationSound" src="/notification.mp3" preload="auto"></audio>

    <!-- Top Control Bar -->
    <div class="top-control-bar">
        <div class="status-indicators">
            <div class="status-badge open" id="cafeStatusBadge">
                <i class="bi bi-shop"></i>
                <span id="cafeStatusText">AÃ§Ä±k</span>
            </div>
            <div class="status-badge live-badge">
                <i class="bi bi-broadcast"></i>
                <span>CanlÄ±</span>
            </div>
            <div class="status-badge" id="notificationStatusBadge" onclick="requestNotificationPermission()"
                style="cursor: pointer;" title="Bildirim izinlerini yÃ¶netmek iÃ§in tÄ±klayÄ±n">
                <i class="bi bi-bell-slash"></i>
                <span>Bildirimler KapalÄ±</span>
            </div>
        </div>
        <div class="control-buttons-row">
            <button class="ctrl-btn" id="btnSaturday" onclick="toggleSaturdayMenu()">
                <i class="bi bi-calendar-week"></i> Cumartesi
            </button>
            <button class="ctrl-btn" onclick="closeCafeQuick('chat')">
                <i class="bi bi-chat-dots"></i> Sohbet
            </button>
            <button class="ctrl-btn" onclick="closeCafeQuick('prayer')">
                <i class="bi bi-moon-stars"></i> Namaz
            </button>
            <button class="ctrl-btn" onclick="closeCafeQuick('break')">
                <i class="bi bi-cup-hot"></i> Mola
            </button>
            <button class="ctrl-btn open-btn" onclick="openCafe()">
                <i class="bi bi-door-open"></i> Kafeyi AÃ§
            </button>
            <button class="ctrl-btn" id="btnSaturday" onclick="toggleSaturdayMenu()"
                style="background: #9333ea; border: 2px solid transparent;">
                <i class="bi bi-calendar-week"></i> Cumartesi MenÃ¼sÃ¼
            </button>
        </div>

        <!-- NEW: Stats in Top Bar -->
        <div class="top-stats-group">
            <div class="stat-pill">
                <span class="stat-label">Bekleyen</span>
                <span class="stat-value" style="color: #ffbd2e;" id="pendingCount">0</span>
            </div>
            <div class="stat-pill">
                <span class="stat-label">Tamamlanan</span>
                <span class="stat-value" style="color: var(--starbucks-green);" id="completedCount">0</span>
            </div>
            <div class="stat-pill">
                <span class="stat-label">Toplam</span>
                <span class="stat-value" id="totalCount">0</span>
            </div>
        </div>
    </div>

    <!-- Sekmeler -->
    <div class="tabs-nav">
        <button class="tab-btn active" onclick="switchTab('orders', this)">
            <i class="bi bi-cup-hot"></i> SipariÅŸler
        </button>
        <button class="tab-btn" onclick="switchTab('video', this)">
            <i class="bi bi-film"></i> TV Reklam
        </button>
        <button class="tab-btn" onclick="switchTab('stock', this)">
            <i class="bi bi-boxes"></i> Stok YÃ¶netimi
        </button>
        <button class="tab-btn" onclick="switchTab('saturday', this)">
            <i class="bi bi-calendar-week"></i> Cumartesi MenÃ¼sÃ¼
        </button>
        <button class="tab-btn" onclick="switchTab('reports', this)">
            <i class="bi bi-bar-chart"></i> Raporlar
        </button>
    </div>

    <!-- SipariÅŸler Sekmesi -->
    <div id="ordersTab" class="tab-content active">
        <style>
            /* Split Orders Layout */
            .orders-split-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                height: calc(100vh - 180px);
                /* Adjust height for scrolling */
                overflow: hidden;
            }

            .orders-column {
                background: rgba(0, 0, 0, 0.2);
                border-radius: 12px;
                padding: 15px;
                border: 1px solid rgba(255, 255, 255, 0.05);
                display: flex;
                flex-direction: column;
                height: 100%;
            }

            .column-header {
                font-size: 1.1rem;
                font-weight: 700;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                display: flex;
                align-items: center;
                gap: 10px;
                flex-shrink: 0;
            }

            .header-hot {
                color: #ff7e5f;
            }

            .header-cold {
                color: #00dc82;
            }

            .column-scroll {
                flex: 1;
                overflow-y: auto;
                padding-right: 5px;
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            /* Custom Scrollbar for columns */
            .column-scroll::-webkit-scrollbar {
                width: 6px;
            }

            .column-scroll::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.1);
            }

            .column-scroll::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.2);
                border-radius: 3px;
            }
        </style>

        <div class="orders-split-container">
            <!-- HOT ORDERS -->
            <div class="orders-column">
                <div class="column-header header-hot">
                    <i class="bi bi-cup-hot-fill"></i> SÄ±cak SipariÅŸler
                </div>
                <div id="hotOrdersContainer" class="column-scroll">
                    <!-- Hot orders go here -->
                    <div class="empty-state" style="padding: 20px 0;">
                        <p>Bekleyen sÄ±cak sipariÅŸ yok.</p>
                    </div>
                </div>
            </div>

            <!-- COLD ORDERS -->
            <div class="orders-column">
                <div class="column-header header-cold">
                    <i class="bi bi-cup-straw"></i> SoÄŸuk SipariÅŸler
                </div>
                <div id="coldOrdersContainer" class="column-scroll">
                    <!-- Cold orders go here -->
                    <div class="empty-state" style="padding: 20px 0;">
                        <p>Bekleyen soÄŸuk sipariÅŸ yok.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TV Reklam Sekmesi -->
    <div id="videoTab" class="tab-content">
        <div style="background: var(--card-dark); padding: 20px; border-radius: 16px; margin-bottom: 20px;">
            <h3 style="color: var(--starbucks-green); margin-bottom: 10px;">
                <i class="bi bi-film"></i> TV Reklam YÃ¶netimi
            </h3>
            <p style="color: var(--text-gray); margin-bottom: 0;">
                Tv-reklam ekranÄ±nda oynatacak videoyu seÃ§in ve yÃ¶netin.
            </p>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
            <!-- URL ile Video Oynat - Now takes more space -->
            <div style="background: var(--card-dark); padding: 20px; border-radius: 16px;">
                <h4 style="color: var(--starbucks-green); margin-bottom: 15px;">
                    <i class="bi bi-link"></i> URL ile Video Oynat
                </h4>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="videoUrlInput" placeholder="YouTube URL (Normal, Shorts, CanlÄ± YayÄ±n)..."
                        style="flex: 1; padding: 10px 15px; background: rgba(255,255,255, 0.1); border: 1px solid rgba(255,255,255, 0.2); border-radius: 8px; color: var(--text-white);">
                    <button onclick="playVideoFromUrl()"
                        style="background: var(--starbucks-green); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="bi bi-play-fill"></i> Oynat
                    </button>
                </div>
                <div style="color: var(--text-gray); font-size: 0.85rem; margin-top: 10px;">
                    <p>âœ“ Normal YouTube videolarÄ±</p>
                    <p>âœ“ YouTube Shorts</p>
                    <p>âœ“ CanlÄ± yayÄ±nlar</p>
                </div>
            </div>

            <!-- Video Kontrolleri -->
            <div style="background: var(--card-dark); padding: 20px; border-radius: 16px;">
                <h4 style="color: var(--starbucks-green); margin-bottom: 15px;">
                    <i class="bi bi-sliders"></i> Kontroller
                </h4>
                <button onclick="stopVideoPlayback()"
                    style="background: var(--danger); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: 600; margin-bottom: 10px;">
                    <i class="bi bi-stop-circle"></i> Videoyu Durdur
                </button>
                <div style="color: var(--text-gray); font-size: 0.9rem; margin-top: 10px;">
                    <p><strong>Durum:</strong> <span id="videoStatus">HazÄ±r</span></p>
                </div>
            </div>
        </div>

        <!-- HazÄ±r SipariÅŸler GÃ¶sterimi -->
        <div style="background: var(--card-dark); padding: 20px; border-radius: 16px;">
            <h4 style="color: var(--starbucks-green); margin-bottom: 15px;">
                <i class="bi bi-list-check"></i> HazÄ±r SipariÅŸleri YÃ¶net
            </h4>
            <div
                style="background: rgba(0, 112, 74, 0.1); padding: 15px; border-radius: 10px; border-left: 3px solid var(--starbucks-green);">
                <p style="color: var(--text-gray); margin-bottom: 0;">
                    TV Reklam ekranÄ±nda hazÄ±r olan sipariÅŸler listesi gÃ¶sterilir. AÅŸaÄŸÄ±da sipariÅŸleri yÃ¶netebilirsiniz.
                </p>
            </div>
            <div id="tvReadyOrdersList" style="margin-top: 15px; display: grid; gap: 10px;"></div>
        </div>
    </div>

    <!-- Stok YÃ¶netimi Sekmesi -->
    <div id="stockTab" class="tab-content">
        <div class="stock-grid" id="stockContainer"></div>
    </div>

    <!-- Cumartesi MenÃ¼sÃ¼ Sekmesi -->
    <div id="saturdayTab" class="tab-content">
        <div style="background: var(--card-dark); padding: 20px; border-radius: 16px; margin-bottom: 20px;">
            <h3 style="color: var(--starbucks-green); margin-bottom: 10px;">
                <i class="bi bi-calendar-week"></i> Cumartesi AkÅŸam MenÃ¼sÃ¼ (18:00 sonrasÄ±)
            </h3>
            <p style="color: var(--text-gray); margin-bottom: 0;">
                Cumartesi gÃ¼nleri saat 18:00'dan sonra sadece burada seÃ§tiÄŸiniz Ã¼rÃ¼nler menÃ¼de gÃ¶rÃ¼necektir.
                MÃ¼ÅŸteriler yalnÄ±zca bu Ã¼rÃ¼nlerden sipariÅŸ verebilir.
            </p>
        </div>

        <div style="margin-bottom: 20px;">
            <button onclick="selectAllSaturdayItems()"
                style="background: var(--starbucks-green); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; margin-right: 10px;">
                <i class="bi bi-check-all"></i> TÃ¼mÃ¼nÃ¼ SeÃ§
            </button>
            <button onclick="deselectAllSaturdayItems()"
                style="background: var(--danger); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                <i class="bi bi-x-lg"></i> TÃ¼mÃ¼nÃ¼ KaldÄ±r
            </button>
        </div>

        <div class="stock-grid" id="saturdayMenuContainer"></div>
    </div>

    <!-- Raporlar Sekmesi -->
    <div id="reportsTab" class="tab-content">
        <div class="reports-container">
            <!-- Filtre ButonlarÄ± -->
            <div style="margin-bottom: 20px; display: flex; gap: 10px; justify-content: center;">
                <button class="report-filter-btn active" data-filter="all" onclick="filterReports('all')">
                    ðŸ“Š TÃ¼m Raporlar
                </button>
                <button class="report-filter-btn" data-filter="daily" onclick="filterReports('daily')">
                    ðŸ“… BugÃ¼n
                </button>
                <button class="report-filter-btn" data-filter="weekly" onclick="filterReports('weekly')">
                    ðŸ“† Bu Hafta
                </button>
                <button class="report-filter-btn" data-filter="monthly" onclick="filterReports('monthly')">
                    ðŸ“ˆ Bu Ay
                </button>
            </div>

            <div class="report-section">
                <h3>ðŸ“… GÃ¼nlÃ¼k Raporlar</h3>
                <div id="dailyReports" class="report-grid"></div>
            </div>
            <div class="report-section">
                <h3>ðŸ“Š AylÄ±k Raporlar</h3>
                <div id="monthlyReports" class="report-grid"></div>
            </div>
        </div>
    </div>

    <!-- Order Ready notification sound -->
    <!-- Order Ready notification sound - handled by top audio element -->
    <!-- Removed duplicate audio element -->

    <!-- New Order notification sound - clear and loud notification sound -->
    <audio id="newOrderSound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
        <source src="https://freesound.org/data/previews/320/320655_5260872-lq.mp3" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const container = document.getElementById('ordersContainer');
        const emptyState = document.getElementById('emptyState');

        let stats = { total: 0, pending: 0, completed: 0 };
        let stockStatus = {}; // Stok durumunu tut
        let cafeIsClosed = false; // Kafe kapalÄ± mÄ±
        let saturdayMenuItems = []; // Cumartesi menÃ¼sÃ¼ iÃ§in seÃ§ilen Ã¼rÃ¼nler
        let saturdayTestMode = false; // Cumartesi test modu
        const customNoteInput = document.getElementById('customNoteInput');
        const customDetailInput = document.getElementById('customDetailInput');
        const prayerNameInput = document.getElementById('prayerNameInput');


        // Service Worker register et (bildirim iÃ§in gerekli)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('Admin: Service Worker baÅŸarÄ±yla kayÄ±t edildi:', registration);
                })
                .catch(err => {
                    console.log('Admin: Service Worker kayÄ±t baÅŸarÄ±sÄ±z:', err);
                });
        } else {
            console.log('Admin: Service Worker desteklenmiyor');
        }

        // Sayfa yÃ¼klendiÄŸinde aktif sipariÅŸleri Ã§ek
        loadActiveOrders();
        socket.emit('getPrayerInfo');
        socket.emit('getReports', { filter: 'daily' }); // GÃ¼nlÃ¼k istatistikleri yÃ¼kle

        // Notification izni iste - Enhanced version
        function requestNotificationPermission() {
            console.log('Admin: requestNotificationPermission Ã§aÄŸrÄ±ldÄ±');
            console.log('Current permission:', Notification.permission);

            if (!('Notification' in window)) {
                console.log('Notification API desteklenmiyor');
                alert('Bu tarayÄ±cÄ± bildirim desteÄŸi sunmuyor.');
                return;
            }

            if (Notification.permission === 'granted') {
                console.log('Ä°zin zaten verilmiÅŸ');
                updateNotificationBadge(true);
                return;
            }

            if (Notification.permission === 'denied') {
                console.log('Bildirim izni reddedilmiÅŸ');
                alert('Bildirim izni reddedilmiÅŸ. LÃ¼tfen tarayÄ±cÄ± ayarlarÄ±ndan bildirimleri aktif edin.');
                updateNotificationBadge(false);
                return;
            }

            // Permission is 'default', request it
            console.log('Ä°zin isteniyor...');
            Notification.requestPermission().then(permission => {
                console.log('Ä°zin yanÄ±tÄ±:', permission);
                if (permission === 'granted') {
                    sendNotification('âœ… Admin Bildirimleri Aktif!', {
                        body: 'Yeni sipariÅŸler geldiÄŸinde bilgilendirileceksiniz.',
                        tag: 'welcome'
                    });
                    updateNotificationBadge(true);
                } else {
                    updateNotificationBadge(false);
                }
            });
        }

        // Update notification status badge
        function updateNotificationBadge(isEnabled) {
            const badge = document.getElementById('notificationStatusBadge');
            if (badge) {
                if (isEnabled) {
                    badge.style.background = 'rgba(0, 112, 74, 0.2)';
                    badge.style.color = 'var(--starbucks-green)';
                    badge.style.borderColor = 'var(--starbucks-green)';
                    badge.innerHTML = '<i class="bi bi-bell-fill"></i> Bildirimler AÃ§Ä±k';
                } else {
                    badge.style.background = 'rgba(255, 95, 87, 0.2)';
                    badge.style.color = 'var(--danger)';
                    badge.style.borderColor = 'var(--danger)';
                    badge.innerHTML = '<i class="bi bi-bell-slash"></i> Bildirimler KapalÄ±';
                }
            }
        }

        // Sayfa yÃ¼klendiÄŸinde notification izni kontrol et ve gerekirse iste
        window.addEventListener('load', () => {
            console.log('Admin sayfa yÃ¼klendi, Firestore\'dan son durum Ã§ekiliyor...');

            // Socket baÄŸlantÄ±sÄ± kurulduktan sonra kafe durumunu Ã§ek
            setTimeout(() => {
                socket.emit('getCafeStatus');
                socket.emit('getSaturdayMenuStatus');
                socket.emit('getStock');
                console.log('ðŸ“‹ Firestore\'dan son durum Ã§ekiliyor...');
            }, 500);

            // Check current permission status
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    updateNotificationBadge(true);
                } else {
                    updateNotificationBadge(false);
                    // Auto-request after a short delay
                    setTimeout(() => {
                        requestNotificationPermission();
                    }, 1500);
                }
            }

            // Initialize audio system on first user interaction
            initializeAudioSystem();
        });

        // Track if audio is unlocked
        let audioUnlocked = false;

        // Initialize audio system to bypass autoplay restrictions
        function initializeAudioSystem() {
            console.log('ðŸ”Š Ses sistemi baÅŸlatÄ±lÄ±yor...');

            // Show persistent reminder to click
            showAudioUnlockReminder();

            // Set up handler to enable audio on ANY interaction
            const enableAudio = function (eventType) {
                console.log('ðŸ”Š KullanÄ±cÄ± etkileÅŸimi algÄ±landÄ±:', eventType);
                const newOrderAudio = document.getElementById('newOrderSound');
                const orderReadyAudio = document.getElementById('notificationSound');

                let unlockPromises = [];

                if (newOrderAudio) {
                    newOrderAudio.volume = 1.0;
                    // Play and immediately pause to "unlock" audio
                    const p1 = newOrderAudio.play().then(() => {
                        newOrderAudio.pause();
                        newOrderAudio.currentTime = 0;
                        console.log('âœ… Yeni sipariÅŸ sesi aktif');
                        return true;
                    }).catch(e => {
                        console.log('âš ï¸ Yeni sipariÅŸ sesi aktifleÅŸtirme baÅŸarÄ±sÄ±z:', e);
                        return false;
                    });
                    unlockPromises.push(p1);
                }

                if (orderReadyAudio) {
                    orderReadyAudio.volume = 1.0;
                    const p2 = orderReadyAudio.play().then(() => {
                        orderReadyAudio.pause();
                        orderReadyAudio.currentTime = 0;
                        console.log('âœ… SipariÅŸ hazÄ±r sesi aktif');
                        return true;
                    }).catch(e => {
                        console.log('âš ï¸ SipariÅŸ hazÄ±r sesi aktifleÅŸtirme baÅŸarÄ±sÄ±z:', e);
                        return false;
                    });
                    unlockPromises.push(p2);
                }

                // Wait for all unlock attempts
                Promise.all(unlockPromises).then(results => {
                    if (results.some(r => r === true)) {
                        audioUnlocked = true;
                        console.log('âœ…âœ…âœ… SES SÄ°STEMÄ° TAMAMEN AKTÄ°F! âœ…âœ…âœ…');
                        // Show success indicator
                        showAudioEnabledIndicator();
                        // Remove reminder
                        hideAudioUnlockReminder();
                        // Remove all event listeners
                        removeAudioUnlockListeners();
                    }
                });
            };

            // Create wrapper functions for each event type
            const clickHandler = () => enableAudio('click');
            const touchHandler = () => enableAudio('touchstart');
            const keyHandler = () => enableAudio('keydown');
            const mouseMoveHandler = () => enableAudio('mousemove');

            // Store handlers for removal
            window._audioUnlockHandlers = {
                click: clickHandler,
                touchstart: touchHandler,
                keydown: keyHandler,
                mousemove: mouseMoveHandler
            };

            // Listen for ANY user interaction
            document.addEventListener('click', clickHandler);
            document.addEventListener('touchstart', touchHandler);
            document.addEventListener('keydown', keyHandler);
            // Also try mousemove as a last resort
            document.addEventListener('mousemove', mouseMoveHandler, { once: true });
        }

        // Remove all audio unlock listeners
        function removeAudioUnlockListeners() {
            if (window._audioUnlockHandlers) {
                document.removeEventListener('click', window._audioUnlockHandlers.click);
                document.removeEventListener('touchstart', window._audioUnlockHandlers.touchstart);
                document.removeEventListener('keydown', window._audioUnlockHandlers.keydown);
                document.removeEventListener('mousemove', window._audioUnlockHandlers.mousemove);
                window._audioUnlockHandlers = null;
            }
        }

        // Show persistent reminder to unlock audio
        function showAudioUnlockReminder() {
            const reminder = document.createElement('div');
            reminder.id = 'audioUnlockReminder';
            reminder.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
                color: white;
                padding: 20px 30px;
                border-radius: 16px;
                box-shadow: 0 10px 40px rgba(255, 107, 107, 0.4);
                z-index: 99998;
                font-size: 1rem;
                font-weight: 700;
                text-align: center;
                cursor: pointer;
                animation: pulse 2s ease-in-out infinite;
            `;
            reminder.innerHTML = `
                <div style="font-size: 2.5rem; margin-bottom: 10px;">ðŸ”‡</div>
                <div style="font-size: 1.1rem; margin-bottom: 5px;">Ses Sistemi KapalÄ±!</div>
                <div style="font-size: 0.85rem; opacity: 0.9;">AktifleÅŸtirmek iÃ§in buraya tÄ±klayÄ±n</div>
            `;

            // Clicking the reminder should trigger audio unlock
            reminder.addEventListener('click', () => {
                console.log('ðŸ”Š HatÄ±rlatÄ±cÄ±ya tÄ±klandÄ±, ses aktifleÅŸtiriliyor...');

                // Immediately hide reminder to give feedback
                hideAudioUnlockReminder();

                // Manually trigger audio unlock
                const newOrderAudio = document.getElementById('newOrderSound');
                const orderReadyAudio = document.getElementById('notificationSound'); // Finds the first one (from file/server)

                if (newOrderAudio) {
                    newOrderAudio.volume = 1.0;
                    newOrderAudio.play().then(() => {
                        newOrderAudio.pause();
                        newOrderAudio.currentTime = 0;
                        console.log('âœ… Yeni sipariÅŸ sesi aktif');
                    }).catch(e => console.log('âš ï¸ Yeni sipariÅŸ sesi aktifleÅŸtirme baÅŸarÄ±sÄ±z:', e));
                }

                if (orderReadyAudio) {
                    orderReadyAudio.volume = 1.0;
                    orderReadyAudio.play().then(() => {
                        orderReadyAudio.pause();
                        orderReadyAudio.currentTime = 0;
                        console.log('âœ… SipariÅŸ hazÄ±r sesi aktif');
                    }).catch(e => console.log('âš ï¸ SipariÅŸ hazÄ±r sesi aktifleÅŸtirme baÅŸarÄ±sÄ±z:', e));
                }

                audioUnlocked = true;
                showAudioEnabledIndicator();
                removeAudioUnlockListeners();
            });

            document.body.appendChild(reminder);
        }

        // Hide the audio unlock reminder
        function hideAudioUnlockReminder() {
            const reminder = document.getElementById('audioUnlockReminder');
            if (reminder) {
                reminder.style.opacity = '0';
                reminder.style.transition = 'opacity 0.5s';
                setTimeout(() => reminder.remove(), 500);
            }
        }

        // Show brief indicator that audio is enabled
        function showAudioEnabledIndicator() {
            const indicator = document.createElement('div');
            indicator.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(0, 112, 74, 0.95);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 12px;
                    box-shadow: 0 10px 30px rgba(0, 112, 74, 0.5);
                    z-index: 99999;
                    font-size: 0.95rem;
                    font-weight: 700;
                    text-align: center;
                `;
            indicator.innerHTML = `
                    <div style="font-size: 1.5rem; margin-bottom: 5px;">ðŸ”Š</div>
                    <div>Ses Sistemi Aktif</div>
                `;
            document.body.appendChild(indicator);

            setTimeout(() => {
                indicator.style.opacity = '0';
                indicator.style.transition = 'opacity 0.5s';
                setTimeout(() => indicator.remove(), 500);
            }, 2000);
        }

        // Bildirim gÃ¶nder - Enhanced version
        function sendNotification(title, options = {}) {
            console.log('Admin sendNotification Ã§aÄŸrÄ±ldÄ±:', title);
            console.log('Notification permission:', Notification.permission);

            if (!('Notification' in window)) {
                console.log('Notification API desteklenmiyor');
                return;
            }

            if (Notification.permission === 'granted') {
                console.log('Bildirim gÃ¶nderiliyor...');
                try {
                    const notification = new Notification(title, {
                        icon: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=100&q=80',
                        badge: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=100&q=80',
                        requireInteraction: true,
                        vibrate: [200, 100, 200],
                        ...options
                    });
                    console.log('âœ… Bildirim baÅŸarÄ±yla oluÅŸturuldu');

                    // Auto-close notification after 10 seconds if not interacted
                    setTimeout(() => notification.close(), 10000);
                } catch (error) {
                    console.error('Bildirim oluÅŸturma hatasÄ±:', error);
                }
            } else if (Notification.permission === 'default') {
                console.log('Bildirim izni henÃ¼z verilmemiÅŸ, izin isteniyor...');
                requestNotificationPermission();
            } else {
                console.log('Bildirim gÃ¶nderilemedi. Permission:', Notification.permission);
                updateNotificationBadge(false);
            }
        }

        // Cumartesi test modunu aÃ§/kapat
        window.toggleSaturdayTest = function () {
            saturdayTestMode = !saturdayTestMode;
            socket.emit('toggleSaturdayTestMode');

            // UI'Ä± gÃ¼ncelle
            const btn = document.getElementById('saturdayTestBtn');
            const text = document.getElementById('saturdayTestText');

            if (saturdayTestMode) {
                btn.style.background = 'rgba(255, 193, 7, 0.3)';
                btn.style.color = '#ffc107';
                btn.style.borderColor = '#ffc107';
                text.textContent = 'Cumartesi Test: AÃ§Ä±k';
            } else {
                btn.style.background = 'rgba(255, 193, 7, 0.2)';
                btn.style.color = '#ffc107';
                btn.style.borderColor = '#ffc107';
                text.textContent = 'Cumartesi Test: KapalÄ±';
            }
        };

        // Kafe durumunu deÄŸiÅŸtir
        window.toggleCafeStatus = function () {
            cafeIsClosed = !cafeIsClosed;
            socket.emit('toggleCafeStatus', { isClosed: cafeIsClosed });

            updateCafeStatusButton();
        };

        function updateCafeStatusButton(noteText) {
            const btn = document.getElementById('cafeStatusBtn');
            const label = noteText ? `KapalÄ± - ${noteText}` : (cafeIsClosed ? 'KapalÄ±' : 'AÃ§Ä±k');
            if (cafeIsClosed) {
                btn.classList.remove('cafe-open');
                btn.classList.add('cafe-closed');
                btn.innerHTML = `<i class="bi bi-door-closed"></i> <span id="cafeStatusText">${label}</span>`;
            } else {
                btn.classList.remove('cafe-closed');
                btn.classList.add('cafe-open');
                btn.innerHTML = `<i class="bi bi-door-open"></i> <span id="cafeStatusText">${label}</span>`;
            }
        }



        function applyCustomClose({ note, detail }) {
            const customNote = note && note.trim() ? note.trim() : 'Sohbet HazÄ±rlÄ±ÄŸÄ±';
            const customDetail = detail && detail.trim() ? detail.trim() : '';

            cafeIsClosed = true;
            updateCafeStatusButton(customNote);

            socket.emit('toggleCafeStatus', {
                isClosed: true,
                closedReason: 'custom',
                customNote: customNote,
                customDetail: customDetail || null
            });
        }

        function applyPrayerClose({ prayerName, prayerTime }) {
            cafeIsClosed = true;
            updateCafeStatusButton(prayerName || 'Namaz Vakti');

            socket.emit('toggleCafeStatus', {
                isClosed: true,
                closedReason: 'prayer',
                prayerName: prayerName || 'Namaz Vakti',
                prayerTime: prayerTime || null
            });
        }

        // === NEW QUICK ACTION FUNCTIONS ===

        // Toggle Saturday menu on/off (uses items from Firebase)
        window.toggleSaturdayMenu = function () {
            // Toggle the Saturday mode on/off
            // Items are already loaded from Firebase
            const btn = document.getElementById('btnSaturday');

            if (btn.classList.contains('active')) {
                // Turn OFF - disable Saturday mode
                socket.emit('toggleSaturdayMode', { active: false });
                btn.classList.remove('active');
            } else {
                // Turn ON - enable Saturday mode with existing Firebase items
                socket.emit('toggleSaturdayMode', { active: true });
                btn.classList.add('active');
            }
        };

        // Update Saturday button active state
        function updateSaturdayButton() {
            const btn = document.getElementById('btnSaturday');
            if (saturdayMenuItems.length > 0) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }

        // Update cafe status badge in top bar
        function updateCafeStatusBadge() {
            const badge = document.getElementById('cafeStatusBadge');
            const text = document.getElementById('cafeStatusText');
            if (cafeIsClosed) {
                badge.classList.remove('open');
                text.textContent = 'KapalÄ±';
            } else {
                badge.classList.add('open');
                text.textContent = 'AÃ§Ä±k';
            }
        }

        // Quick close cafe with preset messages
        window.closeCafeQuick = function (type) {
            const messages = {
                // subtitle is null because it's already hardcoded in TV displays as "Hizmetimize kÄ±sa bir ara veriyoruz"
                chat: { title: 'Sohbet HazÄ±rlÄ±ÄŸÄ±', subtitle: null },
                prayer: { title: 'Namaz Vakti', subtitle: null },
                break: { title: 'Mola', subtitle: null }
            };

            const msg = messages[type];
            if (!msg) return;

            socket.emit('toggleCafeStatus', {
                isClosed: true,
                closedReason: type,
                customNote: msg.title,
                customDetail: msg.subtitle
            });

            cafeIsClosed = true;
            updateCafeStatusButton(msg.title);
            updateCafeStatusBadge();
        };

        // Open cafe
        window.openCafe = function () {
            socket.emit('toggleCafeStatus', { isClosed: false });
            cafeIsClosed = false;
            updateCafeStatusButton();
            updateCafeStatusBadge();
        };

        // Kafe durumunu al
        socket.on('cafeStatus', (status) => {
            cafeIsClosed = !status.isOpen;
            updateCafeStatusBadge();
            if (status.customMessage) customNoteInput.value = status.customMessage;
            if (status.customDetail) customDetailInput.value = status.customDetail;
            if (status.prayerInfo && status.prayerInfo.name) prayerNameInput.value = status.prayerInfo.name;
            if (status.countdownEnd) startCountdown(status.countdownEnd); else clearCountdown();

            updateCafeStatusButton(status.customMessage || (status.prayerInfo?.name ? status.prayerInfo.name : undefined));
        });

        // AnlÄ±k namaz bilgisi (API'den gelen) iÃ§in alanlarÄ± otomatik doldur
        socket.on('prayerInfo', (info) => {
            if (!info) return;
            if (info.name) prayerNameInput.value = info.name;
        });

        // Tab YÃ¶netimi
        function switchTab(tabName, btn) {
            // TÃ¼m sekmeleri gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.classList.remove('active');
            });

            // SeÃ§ili sekmeyi gÃ¶ster
            document.getElementById(tabName + 'Tab').classList.add('active');
            btn.classList.add('active');

            // Stok sekmesine girildiÄŸinde grid'i doldur
            if (tabName === 'stock') {
                renderStockGrid();
            }

            // Cumartesi menÃ¼sÃ¼ sekmesine girildiÄŸinde grid'i doldur
            if (tabName === 'saturday') {
                renderSaturdayMenuGrid();
            }

            // Raporlar sekmesine girildiÄŸinde raporlarÄ± yÃ¼kle
            if (tabName === 'reports') {
                loadReports();
            }
        }

        // MenÃ¼ Ã¼rÃ¼nleri listesi - menu.html ile uyumlu
        const allMenuItems = [
            // Ã‡ay ve Sohbet (8)
            'Bardak Ã‡ay', 'Kupa Ã‡ay', 'Limonlu Ã‡ay', 'YeÅŸil Ã‡ay', 'Kupa Ã‡ay (Bergamot)', 'Limonlu Ã‡ay (Bergamot)', 'Bitki Ã‡ayÄ±', 'Atom Ã‡ayÄ±',
            // SÄ±cak Kahveler (31)
            'Espresso', 'Double Espresso', 'Cortado', 'Espresso Flat White', 'Double Espresso Flat White', 'Macchiato', 'Double Shot Macchiato', 'Red Eye', 'Black Eye', 'Filtre', 'SÃ¼tlÃ¼ Filtre', 'Americano Hafif', 'Americano YoÄŸun', 'SÃ¼tlÃ¼ Americano', 'Latte', 'Sahlep Latte', 'Ã‡ikolat Latte', 'Vanilya Latte', 'Karamel Latte', 'Coconut Latte', 'Mocha', 'White Mocha', 'Mix Mocha', 'Cappuccino', 'Ã‡ikolat Cappuccino', 'Sahlep Cappuccino', 'Vanilya Cappuccino', 'TÃ¼rk Kahvesi', 'SÃ¼tlÃ¼ TÃ¼rk Kahvesi', 'Dibek Kahvesi', 'SÃ¼tlÃ¼ Dibek Kahvesi', 'Atmosfer Coffee',
            // SoÄŸuk Kahveler (25)
            'Shot Espresso', 'Shot Double Espresso', 'Ice Cortado', 'Ice Espresso Flat White', 'Ice Double Espresso Flat White', 'Ice Macchiato', 'Ice Double Shot Macchiato', 'Ice Red', 'Ice Black', 'SoÄŸuk Filtre', 'SoÄŸuk SÃ¼tlÃ¼ Filtre', 'Ice Americano Hafif', 'Ice Americano YoÄŸun', 'Sparkling Americano', 'Ice SÃ¼tlÃ¼ Americano', 'Ice Latte', 'Ice Sahlep Latte', 'Ice Ã‡ikolat Latte', 'Ice Vanilya Latte', 'Ice Hazelnut Latte', 'Ice Caramel Latte', 'Ice Coconut Latte', 'Ice White Mocha', 'Ice Mix Mocha', 'Cococream Latte',
            // HÄ±zlÄ± SoÄŸuklar (9)
            'SÃ¼t', 'Sade Soda', 'Limon Soda', 'Cool Lime', 'SodalÄ± Cool Lime', 'Mango Lime', 'SodalÄ± Mango Lime', 'Cococream', 'Kokteyl',
            // Frozen (10)
            'Ã‡ilek Frozen', 'Lime Frozen', 'Lime Fizz Frozen', 'Mango Frozen', 'The Jungle', 'Sour Jungle', 'Jungle Fizz', 'Jungle Sour Fizz', 'Mix Frozen', 'Mikser Frozen',
            // Milkshake (7)
            'Vanilya Milkshake', 'Ã‡ikolata Milkshake', 'Ã‡ilek Milkshake', 'Muz Milkshake', 'Mango Milkshake', 'Sahlep Milkshake', 'Coconut Milkshake',
            // Geleneksel Kahveler (6) - menu.html'de var ama admin de tekrar listelnmiÅŸ
            'Filtre Kahve', 'SÃ¼tlÃ¼ Filtre Kahve', 'SÃ¼tlÃ¼ Dibek Kahvesi', 'SÃ¼tlÃ¼ TÃ¼rk Kahvesi', 'TÃ¼rk Kahvesi', 'Dibek Kahvesi',
            // Special SÄ±caklar (3)
            'Chai Tea Latte', 'SÄ±cak Ã‡ikolata', 'Sahlep'
        ];

        function renderStockGrid() {
            const stockContainer = document.getElementById('stockContainer');
            stockContainer.innerHTML = '';

            allMenuItems.forEach(item => {
                const isAvailable = stockStatus[item] !== false;
                const statusClass = isAvailable ? 'available' : 'unavailable';
                const statusText = isAvailable ? 'Stokta Var' : 'Stokta Yok';
                const icon = isAvailable ? 'bi-check-circle' : 'bi-exclamation-circle';

                const itemDiv = document.createElement('div');
                itemDiv.className = 'stock-item';
                itemDiv.innerHTML = `
                    <div class="stock-item-name">${item}</div>
                    <button class="stock-toggle-btn ${statusClass}" onclick="toggleStockGlobal(this, '${item}')">
                        <i class="bi ${icon}"></i> ${statusText}
                    </button>
                `;
                stockContainer.appendChild(itemDiv);
            });
        }

        function updateStockButton(itemName, isAvailable) {
            // Stok grid'indeki butonlarÄ± gÃ¼ncelle
            const stockContainer = document.getElementById('stockContainer');
            if (stockContainer.innerHTML === '') return; // Grid doldurulmamÄ±ÅŸsa Ã§Ä±k

            const buttons = stockContainer.querySelectorAll('.stock-toggle-btn');
            buttons.forEach(btn => {
                const parent = btn.closest('.stock-item');
                const name = parent.querySelector('.stock-item-name').textContent;

                if (name === itemName) {
                    const statusClass = isAvailable ? 'available' : 'unavailable';
                    const statusText = isAvailable ? 'Stokta Var' : 'Stokta Yok';
                    const icon = isAvailable ? 'bi-check-circle' : 'bi-exclamation-circle';

                    btn.classList.toggle('available', isAvailable);
                    btn.classList.toggle('unavailable', !isAvailable);
                    btn.innerHTML = `<i class="bi ${icon}"></i> ${statusText}`;
                }
            });
        }

        function toggleStockGlobal(btn, itemName) {
            const isCurrentlyAvailable = btn.classList.contains('available');
            const newStatus = !isCurrentlyAvailable;

            // UI'Ä± gÃ¼ncelle
            btn.classList.toggle('available', newStatus);
            btn.classList.toggle('unavailable', !newStatus);
            btn.innerHTML = newStatus ?
                '<i class="bi bi-check-circle"></i> Stokta Var' :
                '<i class="bi bi-exclamation-circle"></i> Stokta Yok';

            // Sunucuya gÃ¶nder
            socket.emit('updateStock', { itemName: itemName, isAvailable: newStatus });
        }

        // Cumartesi menÃ¼sÃ¼ grid'ini render et
        function renderSaturdayMenuGrid() {
            const container = document.getElementById('saturdayMenuContainer');
            container.innerHTML = '';

            allMenuItems.forEach(item => {
                const isSelected = saturdayMenuItems.includes(item);
                const statusClass = isSelected ? 'available' : 'unavailable';
                const statusText = isSelected ? 'SeÃ§ili' : 'SeÃ§ili DeÄŸil';
                const icon = isSelected ? 'bi-check-circle-fill' : 'bi-circle';

                const itemDiv = document.createElement('div');
                itemDiv.className = 'stock-item';
                itemDiv.innerHTML = `
                    <div class="stock-item-name">${item}</div>
                    <button class="stock-toggle-btn ${statusClass}" onclick="toggleSaturdayMenuItem(this, '${item}')">
                        <i class="bi ${icon}"></i> ${statusText}
                    </button>
                `;
                container.appendChild(itemDiv);
            });
        }

        // Cumartesi menÃ¼sÃ¼nde Ã¼rÃ¼n seÃ§/kaldÄ±r
        window.toggleSaturdayMenuItem = function (btn, itemName) {
            const isCurrentlySelected = btn.classList.contains('available');

            if (isCurrentlySelected) {
                // KaldÄ±r
                saturdayMenuItems = saturdayMenuItems.filter(item => item !== itemName);
                btn.classList.remove('available');
                btn.classList.add('unavailable');
                btn.innerHTML = '<i class="bi bi-circle"></i> SeÃ§ili DeÄŸil';
            } else {
                // Ekle
                saturdayMenuItems.push(itemName);
                btn.classList.remove('unavailable');
                btn.classList.add('available');
                btn.innerHTML = '<i class="bi bi-check-circle-fill"></i> SeÃ§ili';
            }

            // Sunucuya gÃ¶nder
            socket.emit('updateSaturdayMenu', saturdayMenuItems);
        };

        // TÃ¼m Ã¼rÃ¼nleri cumartesi menÃ¼sÃ¼ne ekle
        window.selectAllSaturdayItems = function () {
            saturdayMenuItems = [...allMenuItems];
            socket.emit('updateSaturdayMenu', saturdayMenuItems);
            renderSaturdayMenuGrid();
        };

        // TÃ¼m Ã¼rÃ¼nleri cumartesi menÃ¼sÃ¼nden kaldÄ±r
        window.deselectAllSaturdayItems = function () {
            saturdayMenuItems = [];
            socket.emit('updateSaturdayMenu', saturdayMenuItems);
            renderSaturdayMenuGrid();
        };

        function updateStats() {
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('pendingCount').textContent = stats.pending;
            document.getElementById('completedCount').textContent = stats.completed;
        }

        let currentReportFilter = 'all'; // Aktif filtre

        function loadReports() {
            fetch(`/api/reports?filter=${currentReportFilter}`)
                .then(response => response.json())
                .then(data => {
                    renderDailyReports(data.daily);
                    renderMonthlyReports(data.monthly);
                })
                .catch(error => {
                    console.error('Rapor yÃ¼kleme hatasÄ±:', error);
                });
        }

        function filterReports(filter) {
            currentReportFilter = filter;

            // Buton stillerini gÃ¼ncelle
            document.querySelectorAll('.report-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

            // RaporlarÄ± yeniden yÃ¼kle
            loadReports();
        }

        function loadActiveOrders() {
            fetch('/api/active-orders')
                .then(response => response.json())
                .then(orders => {
                    orders.forEach(order => {
                        addOrderToUI(order);
                    });
                })
                .catch(error => {
                    console.error('Aktif sipariÅŸ yÃ¼kleme hatasÄ±:', error);
                });
        }

        function addOrderToUI(data) {
            stats.total++;
            stats.pending++;
            updateStats();

            // Determine Box
            const isCold = isColdItem(data.item);
            const containerId = isCold ? 'coldOrdersContainer' : 'hotOrdersContainer';
            const container = document.getElementById(containerId);

            if (!container) return; // Safety

            // Hide local empty state if present
            const emptyState = container.querySelector('.empty-state');
            if (emptyState) emptyState.style.display = 'none';

            // Kart OluÅŸtur
            const card = document.createElement('div');
            card.className = 'order-card';
            card.id = `order-${data.id}`;
            card.setAttribute('data-item-name', data.item);
            // Fix: Add missing data attributes for finishOrder
            card.setAttribute('data-order-number', data.orderNumber);
            card.setAttribute('data-guest-name', data.guestName);
            card.setAttribute('data-item', data.item);

            // createdAt'ten zamanÄ± al
            let timeOnly = 'Yeni';
            if (data.createdAt) {
                try {
                    const date = new Date(data.createdAt);
                    timeOnly = date.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                } catch (e) { console.warn(e); }
            }

            // Stok durumunu kontrol et
            const isInStock = stockStatus[data.item] !== false;
            const stockButtonClass = isInStock ? 'btn-stock in-stock' : 'btn-stock';
            const stockButtonText = isInStock ? '<i class="bi bi-check-circle"></i> Stokta Var' : '<i class="bi bi-exclamation-circle"></i> Stokta Yok';

            card.innerHTML = `
                <div class="card-header-row">
                    <span class="guest-name">#${data.orderNumber || '---'} - ${data.guestName}</span>
                    <span class="phone-badge">${data.phone || ''}</span>
                    <span class="time-badge">${timeOnly}</span>
                </div>
                <div class="order-item">
                    ${data.item}
                </div>
                <div class="stock-controls">
                    <button class="btn-stock ${stockButtonClass}" onclick="toggleStock(this, '${data.item}')">
                        ${stockButtonText}
                    </button>
                    <!-- Using finishOrder for consistency -->
                    <button class="btn-complete" style="flex: 1;" onclick="finishOrder(this, '${data.id}')">
                        <i class="bi bi-check-lg"></i> HazÄ±rla
                    </button>
                    <button class="btn-cancel" onclick="cancelOrder('${data.id}', '${data.guestName}')" style="margin-left:8px; background:var(--danger); color:white; border:none; padding:8px; border-radius:8px;">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
            `;

            // Append to the list
            container.appendChild(card);
        }

        function isColdItem(name) {
            if (!name) return false;
            const lowerName = name.toLowerCase();
            const coldKeywords = [
                'ice', 'soÄŸuk', 'cold', 'soda', 'cool', 'lime', 'frozen',
                'milkshake', 'frappe', 'mix frozen', 'cococream', 'kokteyl',
                'jungle', 'fizz', 'bubble', 'churchill', 'sparkling'
            ];
            // Exact matches for short words
            if (lowerName === 'su' || lowerName === 'sÃ¼t') return true;

            // Keyword check
            return coldKeywords.some(keyword => lowerName.includes(keyword));
        }

        function renderDailyReports(dailyData) {
            const container = document.getElementById('dailyReports');
            container.innerHTML = '';

            const sortedDates = Object.keys(dailyData).sort().reverse();

            if (sortedDates.length === 0) {
                container.innerHTML = '<div class="report-card"><p>GÃ¼nlÃ¼k rapor bulunamadÄ±.</p></div>';
                return;
            }

            sortedDates.forEach(date => {
                const dayData = dailyData[date];
                const card = document.createElement('div');
                card.className = 'report-card';

                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('tr-TR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                let html = `<h4>${formattedDate}</h4>`;

                // MÃ¼ÅŸteriler
                html += '<h5>ðŸ‘¥ MÃ¼ÅŸteriler</h5>';
                Object.entries(dayData.customers)
                    .sort(([, a], [, b]) => b - a)
                    .forEach(([name, count]) => {
                        html += `<div class="report-item">
                            <span class="report-name">${name}</span>
                            <span class="report-count">${count}</span>
                        </div>`;
                    });

                // ÃœrÃ¼nler
                html += '<h5>â˜• ÃœrÃ¼nler</h5>';
                Object.entries(dayData.items)
                    .sort(([, a], [, b]) => b - a)
                    .forEach(([item, count]) => {
                        html += `<div class="report-item">
                            <span class="report-name">${item}</span>
                            <span class="report-count">${count}</span>
                        </div>`;
                    });

                card.innerHTML = html;
                container.appendChild(card);
            });
        }

        function renderMonthlyReports(monthlyData) {
            const container = document.getElementById('monthlyReports');
            container.innerHTML = '';

            const sortedMonths = Object.keys(monthlyData).sort().reverse();

            if (sortedMonths.length === 0) {
                container.innerHTML = '<div class="report-card"><p>AylÄ±k rapor bulunamadÄ±.</p></div>';
                return;
            }

            sortedMonths.forEach(month => {
                const monthData = monthlyData[month];
                const card = document.createElement('div');
                card.className = 'report-card';

                const [year, monthNum] = month.split('-');
                const dateObj = new Date(year, monthNum - 1);
                const formattedMonth = dateObj.toLocaleDateString('tr-TR', {
                    year: 'numeric',
                    month: 'long'
                });

                let html = `<h4>${formattedMonth}</h4>`;

                // MÃ¼ÅŸteriler
                html += '<h5>ðŸ‘¥ MÃ¼ÅŸteriler</h5>';
                Object.entries(monthData.customers)
                    .sort(([, a], [, b]) => b - a)
                    .forEach(([name, count]) => {
                        html += `<div class="report-item">
                            <span class="report-name">${name}</span>
                            <span class="report-count">${count}</span>
                        </div>`;
                    });

                // ÃœrÃ¼nler
                html += '<h5>â˜• ÃœrÃ¼nler</h5>';
                Object.entries(monthData.items)
                    .sort(([, a], [, b]) => b - a)
                    .forEach(([item, count]) => {
                        html += `<div class="report-item">
                            <span class="report-name">${item}</span>
                            <span class="report-count">${count}</span>
                        </div>`;
                    });

                card.innerHTML = html;
                container.appendChild(card);
            });
        }

        // Play notification sound when a new order comes in
        function playNewOrderSound() {
            const audio = document.getElementById('newOrderSound');
            if (audio) {
                audio.volume = 1.0; // Maximum volume
                audio.currentTime = 0;

                // Try to play the sound
                const playPromise = audio.play();

                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            console.log("âœ… Yeni sipariÅŸ sesi Ã§alÄ±yor!");

                            // Play the sound 3 times for better attention
                            let playCount = 0;
                            audio.onended = function () {
                                playCount++;
                                if (playCount < 3) {
                                    audio.currentTime = 0;
                                    audio.play().catch(() => { });
                                } else {
                                    audio.onended = null; // Clean up
                                }
                            };
                        })
                        .catch(e => {
                            console.log("âš ï¸ Yeni sipariÅŸ ses izni gerekli:", e);
                            // Show visual alert if sound fails
                            showAudioNotUnlockedWarning();
                        });
                }
            } else {
                console.error("âŒ Ses elementi bulunamadÄ±!");
            }
        }

        // Show very prominent warning that audio is not unlocked
        function showAudioNotUnlockedWarning() {
            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
                color: white;
                padding: 50px 70px;
                border-radius: 24px;
                box-shadow: 0 20px 60px rgba(255, 107, 107, 0.6);
                z-index: 999999;
                font-size: 2.5rem;
                font-weight: 900;
                text-align: center;
                animation: shake 0.5s infinite;
                cursor: pointer;
            `;
            warning.innerHTML = `
                <div style="font-size: 5rem; margin-bottom: 20px;">ðŸ”‡</div>
                <div>SES SÄ°STEMÄ° KAPALI!</div>
                <div style="font-size: 1.5rem; margin-top: 20px; font-weight: 600;">BURAYA TIKLAYIN!</div>
            `;

            // Remove on click
            warning.addEventListener('click', () => {
                warning.remove();
            });

            document.body.appendChild(warning);

            // Auto-remove after 8 seconds
            setTimeout(() => {
                if (warning.parentNode) {
                    warning.style.opacity = '0';
                    warning.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        if (warning.parentNode) warning.remove();
                    }, 500);
                }
            }, 8000);
        }

        // Show alert when audio fails to play
        function showAudioFailureAlert() {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(255, 95, 87, 0.95);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 12px;
                    box-shadow: 0 10px 30px rgba(255, 95, 87, 0.5);
                    z-index: 99999;
                    font-size: 1rem;
                    font-weight: 700;
                    text-align: center;
                    animation: shake 0.5s;
                `;
            alertDiv.innerHTML = `
                    <div style="font-size: 2rem; margin-bottom: 10px;">ðŸ”‡</div>
                    <div>Ses Ã§almadÄ±! LÃ¼tfen sayfaya tÄ±klayÄ±n.</div>
                `;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.style.opacity = '0';
                alertDiv.style.transition = 'opacity 0.5s';
                setTimeout(() => alertDiv.remove(), 500);
            }, 3000);
        }

        // Enable audio on next user click
        let audioEnableHandler = null;
        function enableAudioOnNextClick() {
            if (audioEnableHandler) return; // Already set

            audioEnableHandler = function () {
                const audio = document.getElementById('newOrderSound');
                audio.volume = 1.0;
                audio.play().then(() => {
                    audio.pause();
                    audio.currentTime = 0;
                    console.log('âœ… Ses sistemi aktif edildi');
                }).catch(e => console.log('Ses aktifleÅŸtirme baÅŸarÄ±sÄ±z:', e));

                // Remove handler after first click
                document.removeEventListener('click', audioEnableHandler);
                audioEnableHandler = null;
            };

            document.addEventListener('click', audioEnableHandler);
        }

        // Play notification sound when an order is ready for pickup
        function playOrderReadySound() {
            const audio = document.getElementById('notificationSound');
            audio.currentTime = 0;
            audio.play().catch(e => console.log("SipariÅŸ hazÄ±r ses izni gerekli"));
        }
        // Admin yÃ¼klendiÄŸinde stok durumunu iste
        socket.emit('getStock');

        // Cumartesi menÃ¼sÃ¼ durumunu iste
        socket.emit('getSaturdayMenuStatus');

        // Stok durumunu al
        socket.on('stockStatus', (status) => {
            stockStatus = status;
        });

        // Cumartesi menÃ¼sÃ¼ durumunu al
        socket.on('saturdayMenuStatus', d => {
            saturdayMenuItems = d.items || [];
            const isActive = d.active || false;
            const btn = document.getElementById('btnSaturday');
            if (btn) {
                if (isActive) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            }
            console.log('Cumartesi menÃ¼sÃ¼ yÃ¼klendi:', saturdayMenuItems.length, 'Ã¼rÃ¼n', isActive ? '(AKTIF)' : '(KAPALI)');
        });

        // Cumartesi menÃ¼sÃ¼ gÃ¼ncellendiÄŸinde
        socket.on('saturdayMenuUpdated', items => {
            saturdayMenuItems = items;
            // EÄŸer cumartesi sekmesindeyse grid'i yeniden render et
            const saturdayTab = document.getElementById('saturdayTab');
            if (saturdayTab.classList.contains('active')) {
                renderSaturdayMenuGrid();
            }
        });

        // Cumartesi modu aÃ§Ä±k/kapalÄ± deÄŸiÅŸtiÄŸinde
        socket.on('saturdayModeToggled', data => {
            const btn = document.getElementById('btnSaturday');
            if (data.active) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
            console.log('Cumartesi modu:', data.active ? 'AÃ‡IK' : 'KAPALI');
        });

        // GÃ¼nlÃ¼k Ä°statistikleri GÃ¼ncelle (Server'dan gelen)
        socket.on('dailyStats', stats => {
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('pendingCount').textContent = stats.pending;
            document.getElementById('completedCount').textContent = stats.completed;
        });

        // Stok gÃ¼ncellemelerini dinle
        socket.on('stockUpdated', (data) => {
            stockStatus[data.itemName] = data.isAvailable;
            updateStockButton(data.itemName, data.isAvailable);
            // Stok grid'inde de gÃ¼ncelle
            const gridContainer = document.getElementById('stockContainer');
            if (gridContainer.innerHTML !== '') {
                renderStockGrid();
            }
        });

        function updateStockButton(itemName, isAvailable) {
            // TÃ¼m kartlarda bu Ã¼rÃ¼nÃ¼n butonunu gÃ¼ncelle
            document.querySelectorAll('[data-item-name]').forEach(card => {
                if (card.getAttribute('data-item-name') === itemName) {
                    const btn = card.querySelector('.btn-stock');
                    if (btn) {
                        btn.classList.toggle('in-stock', isAvailable);
                        btn.innerHTML = isAvailable ?
                            '<i class="bi bi-check-circle"></i> Stokta Var' :
                            '<i class="bi bi-exclamation-circle"></i> Stokta Yok';
                    }
                }
            });
        }

        socket.on('newOrder', (data) => {
            console.log('ðŸ”” ========================================');
            console.log('ðŸ”” YENÄ° SÄ°PARÄ°Åž GELDÄ°!');
            console.log('ðŸ”” ========================================');
            console.log('ðŸ“¦ SipariÅŸ DetaylarÄ±:', data);
            console.log('ðŸ”Œ Socket BaÄŸlantÄ±sÄ±:', socket.connected ? 'BAÄžLI âœ…' : 'BAÄžLI DEÄžÄ°L âŒ');
            console.log('ðŸ”” Bildirim Ä°zni:', Notification.permission);
            console.log('ðŸ”” ========================================');

            // CRITICAL: Play sound FIRST to ensure barista hears it
            playNewOrderSound();

            // Vibrate if supported (works on iPad/mobile devices)
            if (navigator.vibrate) {
                // Vibrate pattern: vibrate 300ms, pause 200ms, vibrate 300ms, pause 200ms, vibrate 300ms
                navigator.vibrate([300, 200, 300, 200, 300]);
            }

            // Visual alert as backup
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #00704A, #004d33);
                    color: white;
                    padding: 40px 60px;
                    border-radius: 20px;
                    box-shadow: 0 20px 60px rgba(0, 112, 74, 0.5);
                    z-index: 99999;
                    font-size: 2rem;
                    font-weight: 900;
                    text-align: center;
                    animation: pulse 0.5s ease-in-out infinite alternate;
                `;
            alertDiv.innerHTML = `
                    <div style="font-size: 4rem; margin-bottom: 20px;">ðŸ””</div>
                    <div>YENÄ° SÄ°PARÄ°Åž!</div>
                    <div style="font-size: 1.5rem; margin-top: 15px; font-weight: 600;">#${data.orderNumber} - ${data.guestName}</div>
                    <div style="font-size: 1.2rem; margin-top: 10px; opacity: 0.9;">${data.item}</div>
                `;
            document.body.appendChild(alertDiv);

            // Remove visual alert after 5 seconds
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                alertDiv.style.transition = 'opacity 0.5s';
                setTimeout(() => alertDiv.remove(), 500);
            }, 5000);

            // Try to send browser notification
            console.log('ðŸ”” TarayÄ±cÄ± bildirimi gÃ¶nderiliyor...');
            if (Notification.permission === 'granted') {
                sendNotification(`Yeni SipariÅŸ! - ${data.guestName}`, {
                    body: `${data.item} isteniyor`,
                    tag: 'new-order',
                    requireInteraction: true
                });
                console.log('âœ… Bildirim gÃ¶nderildi');
            } else if (Notification.permission === 'default') {
                console.log('âš ï¸ Bildirim izni yok, izin isteniyor...');
                requestNotificationPermission();
            } else {
                console.log('âŒ Bildirim izni reddedilmiÅŸ, sadece ses ve gÃ¶rsel uyarÄ± kullanÄ±lÄ±yor');
            }

            // Add order to UI
            addOrderToUI(data);

            console.log('ðŸ”” Yeni sipariÅŸ iÅŸleme tamamlandÄ± âœ…');
        });

        window.toggleStock = function (btn, itemName) {
            const isCurrentlyInStock = btn.classList.contains('in-stock');
            const newStatus = !isCurrentlyInStock;

            // UI'Ä± gÃ¼ncelle
            btn.classList.toggle('in-stock', newStatus);
            btn.innerHTML = newStatus ?
                '<i class="bi bi-check-circle"></i> Stokta Var' :
                '<i class="bi bi-exclamation-circle"></i> Stokta Yok';

            // Sunucuya gÃ¶nder
            socket.emit('updateStock', { itemName: itemName, isAvailable: newStatus });
        };

        // === TV REKLAM FONKSÄ°YONLARI ===
        let tvReadyOrders = [];

        // Video yÃ¼kleme ve oynatma
        window.uploadAndPlayVideo = function () {
            const fileInput = document.getElementById('videoInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('LÃ¼tfen bir video dosyasÄ± seÃ§in');
                return;
            }

            // Dosya boyutunu kontrol et (1GB limit)
            if (file.size > 1 * 1024 * 1024 * 1024) {
                alert('Video dosyasÄ± 1GB\'dan kÃ¼Ã§Ã¼k olmalÄ±');
                return;
            }

            // Dosya tipini kontrol et
            if (!file.type.startsWith('video/')) {
                alert('LÃ¼tfen bir video dosyasÄ± seÃ§in');
                return;
            }

            document.getElementById('videoStatus').textContent = 'YÃ¼kleniyor...';

            // Video dosyasÄ±nÄ± multipart/form-data ile gÃ¶nder
            const formData = new FormData();
            formData.append('video', file);

            // Sunucuya HTTP POST ile gÃ¶nder
            fetch('/api/upload-video', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Sunucudan gelen URL'i oynat
                        socket.emit('playVideo', {
                            videoUrl: data.videoUrl
                        });
                        document.getElementById('videoStatus').textContent = `OynatÄ±lÄ±yor: ${file.name}`;
                        updateTvReadyOrdersList();
                    } else {
                        alert('Video yÃ¼klenemedi: ' + data.error);
                        document.getElementById('videoStatus').textContent = 'Hata!';
                    }
                })
                .catch(error => {
                    console.error('Video yÃ¼kleme hatasÄ±:', error);
                    alert('Video yÃ¼klenemedi');
                    document.getElementById('videoStatus').textContent = 'Hata!';
                });
        };

        // URL'den video oynatma
        window.playVideoFromUrl = function () {
            const urlInput = document.getElementById('videoUrlInput');
            const videoUrl = urlInput.value.trim();

            if (!videoUrl) {
                alert('LÃ¼tfen bir URL girin');
                return;
            }

            // YouTube URL kontrolÃ¼ - Normal, Shorts, ve CanlÄ± YayÄ±n desteÄŸi
            if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                let videoId = '';

                try {
                    // youtube.com/watch?v=VIDEO_ID
                    if (videoUrl.includes('youtube.com/watch')) {
                        const params = new URL(videoUrl).searchParams;
                        videoId = params.get('v');
                    }
                    // youtube.com/shorts/VIDEO_ID
                    else if (videoUrl.includes('youtube.com/shorts/')) {
                        const match = videoUrl.match(/\/shorts\/([^?&#]+)/);
                        if (match) videoId = match[1];
                    }
                    // youtube.com/live/VIDEO_ID (canlÄ± yayÄ±n)
                    else if (videoUrl.includes('youtube.com/live/')) {
                        const match = videoUrl.match(/\/live\/([^?&#]+)/);
                        if (match) videoId = match[1];
                    }
                    // youtu.be/VIDEO_ID
                    else if (videoUrl.includes('youtu.be/')) {
                        const pathParts = videoUrl.split('/');
                        videoId = pathParts[pathParts.length - 1].split('?')[0].split('&')[0];
                    }
                    // youtube.com/embed/VIDEO_ID
                    else if (videoUrl.includes('youtube.com/embed/')) {
                        const match = videoUrl.match(/\/embed\/([^?&#]+)/);
                        if (match) videoId = match[1];
                    }
                } catch (e) {
                    console.error('YouTube URL Ã§Ã¶zÃ¼mleme hatasÄ±:', e);
                }

                if (videoId && videoId.length > 0) {
                    // YouTube embed URL'si oluÅŸtur
                    const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                    console.log('YouTube embed URL:', embedUrl);
                    socket.emit('playVideo', {
                        videoUrl: embedUrl,
                        isYouTube: true
                    });
                    document.getElementById('videoStatus').textContent = 'YouTube Video OynatÄ±lÄ±yor...';
                } else {
                    alert('YouTube URL\'si geÃ§ersiz');
                    return;
                }
            } else {
                // Normal video URL'si
                socket.emit('playVideo', {
                    videoUrl: videoUrl
                });
                document.getElementById('videoStatus').textContent = 'OynatÄ±lÄ±yor...';
            }

            updateTvReadyOrdersList();
        };

        // Video oynatmayÄ± durdur
        window.stopVideoPlayback = function () {
            socket.emit('stopVideo');
            document.getElementById('videoStatus').textContent = 'HazÄ±r';
            document.getElementById('videoInput').value = '';
            document.getElementById('videoUrlInput').value = '';
        };

        // HazÄ±r sipariÅŸleri TV sayfasÄ±nda gÃ¶ster
        socket.on('readyOrders', (orders) => {
            tvReadyOrders = orders || [];
            updateTvReadyOrdersList();
        });

        // Yeni sipariÅŸin hazÄ±r olduÄŸunu al
        socket.on('orderReadyForTv', (order) => {
            tvReadyOrders.push(order);
            updateTvReadyOrdersList();
        });

        // SipariÅŸin tamamlandÄ±ÄŸÄ±nÄ± al
        socket.on('orderCompletedOnTv', (orderId) => {
            tvReadyOrders = tvReadyOrders.filter(o => o.id !== orderId);
            updateTvReadyOrdersList();
        });

        // HazÄ±r sipariÅŸler listesini gÃ¼ncelle
        function updateTvReadyOrdersList() {
            const container = document.getElementById('tvReadyOrdersList');

            if (!tvReadyOrders || tvReadyOrders.length === 0) {
                container.innerHTML = '<div style="color: var(--text-gray); padding: 20px; text-align: center;">HazÄ±r sipariÅŸ bulunmamaktadÄ±r</div>';
                return;
            }

            container.innerHTML = tvReadyOrders.map(order => `
                <div style="background: rgba(0, 112, 74, 0.2); padding: 15px; border-radius: 10px; border-left: 3px solid var(--starbucks-green); display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 700; color: var(--starbucks-green); font-size: 1.1rem;">#${order.orderNumber}</div>
                        <div style="color: var(--text-gray); font-size: 0.9rem; margin-top: 4px;">${order.guestName}</div>
                    </div>
                    <button onclick="completeOrderFromTv('${order.id}')" style="background: var(--starbucks-green); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="bi bi-check-circle"></i> SipariÅŸ Teslim Edildi
                    </button>
                </div>
            `).join('');
        }

        // TV'den sipariÅŸ tamamlama
        window.completeOrderFromTv = function (orderId) {
            socket.emit('completeOrderFromTv', { orderId: orderId });
            // Listeden kaldÄ±r
            tvReadyOrders = tvReadyOrders.filter(o => o.id !== orderId);
            updateTvReadyOrdersList();
        };

        // Ä°lk yÃ¼klenmede hazÄ±r sipariÅŸleri iste
        socket.emit('getReadyOrdersForTv');

        window.finishOrder = function (btn, id) {
            const card = btn.parentElement.parentElement;

            // Get order data from data attributes
            const orderNumber = card.getAttribute('data-order-number');
            const guestName = card.getAttribute('data-guest-name');
            const item = card.getAttribute('data-item');

            // Emit orderReady event to notify customer
            socket.emit('completeOrder', {
                orderId: id,
                orderNumber: orderNumber,
                guestName: guestName,
                item: item
            });

            // Animasyonla Sil
            card.style.transform = 'scale(0.9) translateY(20px)';
            card.style.opacity = '0';

            setTimeout(() => {
                card.remove();
                stats.pending--;
                stats.completed++;
                updateStats();

                // EÄŸer kart kalmadÄ±ysa boÅŸ durumu gÃ¶ster
                if (container.children.length === 0 || (container.children.length === 1 && container.children[0].id === 'emptyState')) {
                    if (emptyState) emptyState.style.display = 'block';
                }
            }, 300);
        };
    </script>
</body>

</html>