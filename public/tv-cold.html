<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atmosfer Kafe - Crystal Cold Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            /* RENK PALETÄ° */
            --bg-dark: #02040a;
            --glass-bg: rgba(18, 26, 43, 0.65); /* Daha koyu, daha okunabilir cam */
            --glass-border: rgba(100, 200, 255, 0.15);
            --neon-blue: #00f2ff;
            --neon-glow: rgba(0, 242, 255, 0.4);
            --text-main: #ffffff;
            --text-dim: #8b9bb4;
            --danger: #ff3366;
            --danger-glow: rgba(255, 51, 102, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            /* Hafif hareketli arka plan */
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(0, 40, 80, 0.4), transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 100, 150, 0.2), transparent 40%);
            color: var(--text-main);
            font-family: 'Oswald', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            padding: 2vh 3vw;
            display: flex;
            flex-direction: column;
            user-select: none; /* TV'de seÃ§im yapÄ±lmasÄ±n */
        }

        /* --- HEADER --- */
        .header {
            height: 12vh;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2vh;
            padding: 0 1vw;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .brand-block { display: flex; flex-direction: column; }

        .brand-title {
            font-family: 'Rajdhani', sans-serif; /* Daha fÃ¼tÃ¼ristik baÅŸlÄ±k */
            font-size: 7vh;
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            line-height: 0.8;
            letter-spacing: 2px;
            text-shadow: 0 0 20px var(--neon-glow);
        }

        .brand-subtitle {
            font-size: 2.2vh;
            color: var(--neon-blue);
            letter-spacing: 6px;
            text-transform: uppercase;
            font-weight: 400;
            margin-top: 0.5vh;
            margin-left: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-right { display: flex; align-items: center; gap: 2vw; }

        .header-logo-mini {
            height: 9vh;
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.1));
        }

        .mode-badge {
            background: rgba(0, 242, 255, 0.1);
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 0.8vh 2vh;
            border-radius: 4px;
            font-size: 2vh;
            font-weight: 600;
            letter-spacing: 2px;
            box-shadow: 0 0 15px var(--neon-glow);
            animation: pulseBadge 2s infinite;
            display: none; /* JS ile aÃ§Ä±lÄ±r */
        }

        @keyframes pulseBadge {
            0% { box-shadow: 0 0 10px var(--neon-glow); }
            50% { box-shadow: 0 0 25px var(--neon-glow), inset 0 0 10px var(--neon-glow); }
            100% { box-shadow: 0 0 10px var(--neon-glow); }
        }

        /* --- GRID YAPISI --- */
        .main-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2.5vw; /* Kolonlar arasÄ± boÅŸluk */
            height: 84vh;
            width: 100%;
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 1.2vh; /* Kartlar arasÄ± boÅŸluk - azaltÄ±ldÄ± */
        }

        /* --- MENÃœ KARTI --- */
        .menu-section {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.2vh 1.5vh;
            position: relative;
            backdrop-filter: blur(16px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        /* Kategori BaÅŸlÄ±ÄŸÄ± */
        .section-header {
            display: flex;
            align-items: center;
            gap: 1vh;
            margin-bottom: 0.8vh;
            padding-bottom: 0.6vh;
            border-bottom: 1px solid rgba(0, 242, 255, 0.3);
        }

        .section-icon { 
            font-size: 2.2vh; 
            color: var(--neon-blue);
            filter: drop-shadow(0 0 8px var(--neon-glow));
        }
        
        .section-title {
            font-size: 2.4vh;
            color: #fff;
            text-transform: uppercase;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.3);
        }

        /* --- LÄ°STE ELEMANLARI --- */
        .menu-list { display: flex; flex-direction: column; gap: 0.4vh; }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 2.3vh;
            color: #e0e6ed;
            font-weight: 400;
            letter-spacing: 0.5px;
            height: 3.2vh; /* Sabit yÃ¼kseklik hizalama iÃ§in */
        }

        .item-name {
            z-index: 2;
            white-space: nowrap; /* SatÄ±r kaymasÄ±nÄ± engelle */
        }

        /* Lider Noktalar (Dotted Line) */
        .dots {
            flex-grow: 1;
            margin: 0 10px;
            border-bottom: 2px dotted rgba(255, 255, 255, 0.15);
            position: relative;
            top: -4px;
        }

        /* Stok Durumu */
        .item-status { font-size: 1.8vh; }

        .menu-item.unavailable .item-name { 
            color: var(--text-dim); 
            opacity: 0.6; 
            text-decoration: none; /* ÃœstÃ¼ Ã§izili yerine sÃ¶nÃ¼k yapalÄ±m, daha modern */
        }
        
        .stock-tag {
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 0.1vh 0.8vh;
            border-radius: 4px;
            font-weight: 700;
            background: rgba(255, 51, 102, 0.1);
            box-shadow: 0 0 8px var(--danger-glow);
            font-size: 1.6vh;
            letter-spacing: 1px;
        }

        /* --- NAMAZ VAKTÄ° EKRANI --- */
        #cafeStatusBanner {
            display: none;
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0, 0, 0, 0.96);
            z-index: 9999;
            flex-direction: column; justify-content: center; align-items: center;
            backdrop-filter: blur(20px);
        }

        .status-logo-img {
            height: 30vh;
            width: auto;
            margin-bottom: 4vh;
            filter: grayscale(100%) brightness(200%) drop-shadow(0 0 30px rgba(255,255,255,0.2));
        }

        .status-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 14vh;
            color: #fff;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 10px;
            margin-bottom: 1vh;
            text-shadow: 0 0 40px rgba(255,255,255,0.3);
        }
        
        .status-subtitle {
            font-size: 4vh;
            color: var(--neon-blue);
            font-weight: 300;
            letter-spacing: 4px;
            text-transform: uppercase;
            border-top: 1px solid var(--glass-border);
            padding-top: 2vh;
        }

        /* GiriÅŸ Animasyonu */
        .fade-in { animation: fadeIn 0.6s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- QR KOD --- */
        .qr-code {
            position: fixed;
            bottom: 2vh;
            right: 2vh;
            width: 160px;
            height: 160px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .qr-code img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="brand-block">
            <div class="brand-title">ATMOSFER KAFE</div>
            <div class="brand-subtitle"><i class="fas fa-snowflake fa-spin" style="--fa-animation-duration: 10s;"></i> KRÄ°STAL SOÄžUK MENÃœ</div>
        </div>
        <div class="header-right">
            <div id="saturdayBadge" class="mode-badge">CUMARTESÄ° Ã–ZEL</div>
            <img src="cinarlogo3.png" alt="Logo" class="header-logo-mini" onerror="this.style.display='none'">
        </div>
    </div>

    <div class="main-content" id="mainContainer">
        </div>

    <div id="cafeStatusBanner">
        <img src="cinarlogo3.png" alt="Logo" class="status-logo-img" onerror="this.style.display='none'">
        <div class="status-title">NAMAZ VAKTÄ°</div>
        <div class="status-subtitle">Hizmetimize kÄ±sa bir ara veriyoruz</div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = typeof io !== 'undefined' ? io() : { emit:()=>{}, on:(e,c)=>{if(e==='stockStatus')c({})} };
        
        let stockStatus = {};
        let saturdayMenuItems = []; 
        let isSaturdayEvening = false;
        let cafeIsClosed = false;

        // VERÄ°LER (MENÃœ Ä°Ã‡ERÄ°ÄžÄ°)
        const menuSections = [
            // SOL KOLON
            { 
                title: 'Ice Espresso', 
                icon: 'fa-cube', 
                items: [
                    'Shot Espresso', 'Shot Double Espresso', 'Ice Cortado', 
                    'Ice Espresso Flat White', 'Ice Double Espresso Flat White', 
                    'Ice Macchiato', 'Ice Double Shot Macchiato'
                ] 
            },
            { 
                title: 'Ice Americano', 
                icon: 'fa-glass-water', 
                items: [
                    'Ice Americano Hafif', 'Ice Americano YoÄŸun', 'Ice SÃ¼tlÃ¼ Americano', 
                    'Sparkling Americano', 'Ice Red', 'Ice Black', 
                    'SoÄŸuk Filtre', 'SoÄŸuk SÃ¼tlÃ¼ Filtre'
                ] 
            },
            
            // ORTA KOLON
            { 
                title: 'Ice Latte', 
                icon: 'fa-whiskey-glass', 
                items: [
                    'Ice Latte', 'Ice Sahlep Latte', 'Ice Ã‡ikolata Latte', 
                    'Ice Vanilya Latte', 'Ice Hazelnut Latte', 
                    'Ice Caramel Latte', 'Ice Coconut Latte'
                ] 
            },
            { 
                title: 'Ice Mocha', 
                icon: 'fa-mug-hot', 
                items: [
                    'Ice White Mocha', 'Ice Mix Mocha', 'Cococream Latte'
                ] 
            },
            { 
                title: 'Milkshake', 
                icon: 'fa-blender', 
                items: [
                    'Vanilya Milkshake', 'Ã‡ikolata Milkshake', 'Ã‡ilek Milkshake', 
                    'Muz Milkshake', 'Mango Milkshake', 'Sahlep Milkshake'
                ] 
            },
            
            // SAÄž KOLON
            { 
                title: 'Frozen', 
                icon: 'fa-snowflake', 
                items: [
                    'Ã‡ilek Frozen', 'Lime Frozen', 'Lime Fizz Frozen', 
                    'Mango Frozen', 'The Jungle', 'Sour Jungle', 
                    'Jungle Fizz', 'Jungle Sour Fizz', 'Mix Frozen'
                ] 
            },
            { 
                title: 'Special SoÄŸuklar', 
                icon: 'fa-bottle-water', 
                items: [
                    'SÃ¼t', 'Sade Soda', 'Limon Soda', 
                    'Cool Lime', 'SodalÄ± Cool Lime', 'Mango Lime', 
                    'SodalÄ± Mango Lime', 'Cococream', 'Kokteyl'
                ] 
            }
        ];

        function renderMenu() {
            const container = document.getElementById('mainContainer');
            container.innerHTML = ''; 

            const columns = [];
            const colHeights = [0, 0, 0]; 

            // 3 Kolon OluÅŸtur
            for(let i=0; i<3; i++) {
                const div = document.createElement('div');
                div.className = 'column';
                container.appendChild(div);
                columns.push(div);
            }

            // Cumartesi Filtresi
            let sectionsToRender = JSON.parse(JSON.stringify(menuSections));
            if (isSaturdayEvening) {
                document.getElementById('saturdayBadge').style.display = 'block';
                if (saturdayMenuItems.length > 0) {
                    sectionsToRender = sectionsToRender.map(s => {
                        s.items = s.items.filter(i => saturdayMenuItems.includes(i));
                        return s;
                    }).filter(s => s.items.length > 0);
                }
            } else {
                document.getElementById('saturdayBadge').style.display = 'none';
            }

            // KartlarÄ± DaÄŸÄ±t (Basit YÃ¼kseklik AlgoritmasÄ±)
            sectionsToRender.forEach((section, idx) => {
                const secDiv = document.createElement('div');
                secDiv.className = 'menu-section fade-in';
                secDiv.style.animationDelay = `${idx * 0.05}s`; // Waterfall efekti

                let html = `
                    <div class="section-header">
                        <i class="fas ${section.icon} section-icon"></i>
                        <span class="section-title">${section.title}</span>
                    </div>
                    <div class="menu-list">
                `;

                section.items.forEach(item => {
                    let isUnavailable = stockStatus[item] === false;
                    if (isUnavailable) {
                        console.log(`ðŸš« Item "${item}" is unavailable. stockStatus[${item}] =`, stockStatus[item]);
                    }
                    let extraClass = isUnavailable ? 'unavailable' : '';
                    let statusHtml = isUnavailable ? '<span class="stock-tag">TÃœKENDÄ°</span>' : ''; // "YOK" yerine "TÃœKENDÄ°" daha ÅŸÄ±k
                    
                    html += `
                        <div class="menu-item ${extraClass}">
                            <span class="item-name">${item}</span>
                            <span class="dots"></span>
                            <span class="item-status">${statusHtml}</span>
                        </div>
                    `;
                });
                html += '</div>';
                secDiv.innerHTML = html;

                // En kÄ±sa kolona ekle
                const minCol = colHeights.indexOf(Math.min(...colHeights));
                columns[minCol].appendChild(secDiv);
                // YÃ¼kseklik tahmini (Header + Items)
                colHeights[minCol] += (section.items.length * 1.2 + 4); 
            });
        }

        function updateCafeStatus() {
            document.getElementById('cafeStatusBanner').style.display = cafeIsClosed ? 'flex' : 'none';
        }

        // Socket Events
        socket.emit('getStock');
        socket.emit('getSaturdayMenuStatus');
        socket.emit('getCafeStatus');

        socket.on('stockStatus', s => { 
            console.log('ðŸ“¦ stockStatus received:', JSON.stringify(s, null, 2));
            stockStatus = s; 
            renderMenu(); 
        });
        socket.on('stockUpdated', d => { 
            console.log('ðŸ”„ stockUpdated received:', d);
            console.log('   Item name:', d.itemName, 'Is Available:', d.isAvailable);
            stockStatus[d.itemName] = d.isAvailable;
            console.log('âœ… Updated stockStatus after update:', JSON.stringify(stockStatus, null, 2));
            renderMenu(); 
        });
        socket.on('saturdayMenuStatus', d => { saturdayMenuItems = d.items || []; isSaturdayEvening = d.isSaturdayEvening; renderMenu(); });
        socket.on('saturdayMenuUpdated', i => { saturdayMenuItems = i; isSaturdayEvening = i.length > 0; renderMenu(); });
        socket.on('cafeStatus', s => { cafeIsClosed = s.isClosed; updateCafeStatus(); });

        // Klavye KÄ±sayollarÄ± (Test Ä°Ã§in)
        document.addEventListener('keydown', e => {
            if(e.key === 's') { isSaturdayEvening = !isSaturdayEvening; if(!saturdayMenuItems.length) saturdayMenuItems=['Ice Latte', 'Cool Lime']; renderMenu(); }
            if(e.key === 'c') { cafeIsClosed = !cafeIsClosed; updateCafeStatus(); }
        });

        renderMenu();
    </script>

    <!-- QR KOD -->
    <div class="qr-code">
        <img src="qr.png" alt="SipariÅŸ QR Kodu" onerror="this.parentElement.style.display='none'">
    </div>
</body>
</html>